{"version":3,"file":"commonHelpers2.js","sources":["../src/js/shopping.js"],"sourcesContent":["import Pagination from 'tui-pagination';\nimport { showLoader, hideLoader } from './loader.js';\nimport { writeUserShoppingList } from './auth.js';\n// import 'tui-pagination/dist/tui-pagination.css';\n\nconst LOCAL_KEY = \"booklist\";\nconst container = document.querySelector(\"#pagination\");\nconst cartList = document.querySelector(\".cart-list\");\nconst emptyCart = document.querySelector(\".empty-cart\");\n\nconst windowInnerWidth = window.innerWidth;\n\nlet itemPerPage = 4;\nlet visiblePage = 2;\n\nif (windowInnerWidth > 768) {\n    itemPerPage = 3;\n    visiblePage = 3;\n}\n\nemptyCart.style.display = \"none\";\n\nlet data = [];\n\nshowLoader();\n\ntry {\n    data = JSON.parse(localStorage.getItem(LOCAL_KEY));\n    hideLoader();\n        if (!data.length) {\n            emptyCart.style.display = \"block\";\n        } \n    if (data.length <=itemPerPage) {\n            container.style.display = \"none\";\n        } \n            cartList.innerHTML = createCartMurkup(data, 1);\n        \n  } catch (error) {\n    console.error(\"Get state error: \", error.message);\n  }\n\nconst options = {\n    totalItems: data.length,\n    itemsPerPage: itemPerPage,\n    visiblePages: visiblePage,\n    page: 1,\n    centerAlign: false,\n    template: {\n         page: '<a href=\"#\" class=\"tui-page-btn\">{{page}}</a>',\n         currentPage: '<strong class=\"tui-page-btn tui-is-selected\">{{page}}</strong>',\n         moveButton:\n             '<a href=\"#\" class=\"tui-page-btn tui-{{type}}\">' +\n                 '<span class=\"tui-ico-{{type}}\">{{type}}</span>' +\n             '</a>',\n         disabledMoveButton:\n             '<span class=\"tui-page-btn tui-is-disabled tui-{{type}}\">' +\n                 '<span class=\"tui-ico-{{type}}\">{{type}}</span>' +\n             '</span>',\n         moreButton:\n             '<a href=\"#\" class=\"tui-page-btn tui-{{type}}-is-ellip\">' +\n                 '<span class=\"tui-ico-ellip\">...</span>' +\n             '</a>'\n     }\n}\n\nlet pagination = new Pagination(container, options);\n\n\n\ndocument.addEventListener(\"click\", handlerDeleteCart);\n\n\npagination.on('afterMove', (event) => {\n    let currentPage = event.page;\n     cartList.innerHTML = createCartMurkup(data, currentPage);\n});\n\n\n\n\n\n\n\n\n\n// ----------------------------------------------------------------------------------------РОЗМІТКА\n\nfunction createCartMurkup(arr, currentPage) {\n    cartList.innerHTML = \"\";\n    // hideLoader();\n    const start = itemPerPage * (currentPage-1);\n    const end = start + itemPerPage;\n    const paginatedData = arr.slice(start, end);\n    return paginatedData.map(({ _id, author, book_image, title, description, buy_links: [{url:amazon}, {url:appleBook}], list_name }) =>\n        ` <li class=\"cart-item\" data-id =\"${_id}\">\n            <img src=\"${book_image}\" alt=\"${title}\" class=\"cart-item-img\">\n            <div class=\"cart-item-content\">\n            <div class=\"cart-content-header\">\n                <h3 class=\"cart-item-title\">${title}</h3>\n                <p class=\"cart-item-category cart-item-label\">${list_name}</p>\n            </div>\n                <p class=\"cart-item-description\">${description}</p>\n                <p class=\"cart-item-author cart-item-label\">${author}</p>\n                <button class=\"cart-item-delete\">\n                <svg class=\"cart-delete-icon\" width=\"24\" height=\"24\">\n                <use href=\"../img/icons-sprite.svg#cart-purple-round\"></use>\n                </svg>\n                </button>\n                <ul class=\"cart-item-links\">\n                <li><a href=\"${amazon}\" target=\"_blank\" class=\"cart-item-link\"><img src=\"./amazon.png\" alt=\"amazon\" widht=\"32\" height=\"11\" class=\"modal-img-shop cart-link-img-amazon\"/></a></li>\n                <li><a href=\"${appleBook}\" target=\"_blank\" class=\"cart-item-link\"><img src=\"./apple-books.png\" alt=\"apple-books\" widht=\"16\" height=\"16\" class=\"modal-img-shop cart-link-img-apple\"/></a></li>\n                </ul>\n            </div>\n        </li>`).join(\"\");\n}\n\n\n// ----------------------------------------------------------------------------------------ВИДАЛЕННЯ ЕЛЕМЕНТІВ КОРЗИНИ\n\n\nfunction handlerDeleteCart(e) {\n    if (!e.target.closest(\".cart-item-delete\")) return;\n   \n    const idOfBook = e.target.closest(\".cart-item\").dataset.id;\n    try {\n        const indexToDelete = data.findIndex(({ _id }) => _id === idOfBook);\n        const oldPage = Math.floor(indexToDelete / itemPerPage + 1);\n        const products = data.filter(({ _id }) => _id !== idOfBook);\n        localStorage.setItem(LOCAL_KEY, JSON.stringify(products));\n        writeUserShoppingList(products);\n        data = JSON.parse(localStorage.getItem(LOCAL_KEY));\n        const pageCount = Math.floor((products.length - 1) / itemPerPage + 1);\n        pagination.setTotalItems(products.length);\n        pagination.reset(products.length);\n        pagination.movePageTo(oldPage > pageCount ? pageCount : oldPage);\n\n        if (data.length <=itemPerPage) {\n            container.style.display = \"none\";\n        } \n        let currentPage = pagination.getCurrentPage();\n       \n        cartList.innerHTML = createCartMurkup(data, currentPage);\n  } catch (error) {\n    console.error(\"Get state error: \", error.message);\n    }\n    if (!data.length) {\n    emptyCart.style.display = \"block\";\n}\n}\n\n\n\n\n\n\n"],"names":["LOCAL_KEY","container","cartList","emptyCart","windowInnerWidth","itemPerPage","visiblePage","data","showLoader","hideLoader","createCartMurkup","error","options","pagination","Pagination","handlerDeleteCart","event","currentPage","arr","start","end","_id","author","book_image","title","description","amazon","appleBook","list_name","idOfBook","indexToDelete","oldPage","products","writeUserShoppingList","pageCount"],"mappings":"kHAKA,MAAMA,EAAY,WACZC,EAAY,SAAS,cAAc,aAAa,EAChDC,EAAW,SAAS,cAAc,YAAY,EAC9CC,EAAY,SAAS,cAAc,aAAa,EAEhDC,EAAmB,OAAO,WAEhC,IAAIC,EAAc,EACdC,EAAc,EAEdF,EAAmB,MACnBC,EAAc,EACdC,EAAc,GAGlBH,EAAU,MAAM,QAAU,OAE1B,IAAII,EAAO,CAAA,EAEXC,IAEA,GAAI,CACAD,EAAO,KAAK,MAAM,aAAa,QAAQP,CAAS,CAAC,EACjDS,IACSF,EAAK,SACNJ,EAAU,MAAM,QAAU,SAE9BI,EAAK,QAASF,IACVJ,EAAU,MAAM,QAAU,QAE1BC,EAAS,UAAYQ,EAAiBH,EAAM,CAAC,CAEtD,OAAQI,EAAP,CACA,QAAQ,MAAM,oBAAqBA,EAAM,OAAO,CACjD,CAEH,MAAMC,EAAU,CACZ,WAAYL,EAAK,OACjB,aAAcF,EACd,aAAcC,EACd,KAAM,EACN,YAAa,GACb,SAAU,CACL,KAAM,gDACN,YAAa,iEACb,WACI,mGAGJ,mBACI,gHAGJ,WACI,mGAGP,CACN,EAEA,IAAIO,EAAa,IAAIC,EAAWb,EAAWW,CAAO,EAIlD,SAAS,iBAAiB,QAASG,CAAiB,EAGpDF,EAAW,GAAG,YAAcG,GAAU,CAClC,IAAIC,EAAcD,EAAM,KACvBd,EAAS,UAAYQ,EAAiBH,EAAMU,CAAW,CAC5D,CAAC,EAYD,SAASP,EAAiBQ,EAAKD,EAAa,CACxCf,EAAS,UAAY,GAErB,MAAMiB,EAAQd,GAAeY,EAAY,GACnCG,EAAMD,EAAQd,EAEpB,OADsBa,EAAI,MAAMC,EAAOC,CAAG,EACrB,IAAI,CAAC,CAAE,IAAAC,EAAK,OAAAC,EAAQ,WAAAC,EAAY,MAAAC,EAAO,YAAAC,EAAa,UAAW,CAAC,CAAC,IAAIC,CAAM,EAAG,CAAC,IAAIC,CAAS,CAAC,EAAG,UAAAC,CAAW,IAC5H,oCAAoCP;AAAA,wBACpBE,WAAoBC;AAAA;AAAA;AAAA,8CAGEA;AAAA,gEACkBI;AAAA;AAAA,mDAEbH;AAAA,8DACWH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAO/BI;AAAA,+BACAC;AAAA;AAAA;AAAA,cAGjB,EAAE,KAAK,EAAE,CACvB,CAMA,SAASZ,EAAkB,EAAG,CAC1B,GAAI,CAAC,EAAE,OAAO,QAAQ,mBAAmB,EAAG,OAE5C,MAAMc,EAAW,EAAE,OAAO,QAAQ,YAAY,EAAE,QAAQ,GACxD,GAAI,CACA,MAAMC,EAAgBvB,EAAK,UAAU,CAAC,CAAE,IAAAc,KAAUA,IAAQQ,CAAQ,EAC5DE,EAAU,KAAK,MAAMD,EAAgBzB,EAAc,CAAC,EACpD2B,EAAWzB,EAAK,OAAO,CAAC,CAAE,IAAAc,KAAUA,IAAQQ,CAAQ,EAC1D,aAAa,QAAQ7B,EAAW,KAAK,UAAUgC,CAAQ,CAAC,EACxDC,EAAsBD,CAAQ,EAC9BzB,EAAO,KAAK,MAAM,aAAa,QAAQP,CAAS,CAAC,EACjD,MAAMkC,EAAY,KAAK,OAAOF,EAAS,OAAS,GAAK3B,EAAc,CAAC,EACpEQ,EAAW,cAAcmB,EAAS,MAAM,EACxCnB,EAAW,MAAMmB,EAAS,MAAM,EAChCnB,EAAW,WAAWkB,EAAUG,EAAYA,EAAYH,CAAO,EAE3DxB,EAAK,QAASF,IACdJ,EAAU,MAAM,QAAU,QAE9B,IAAIgB,EAAcJ,EAAW,iBAE7BX,EAAS,UAAYQ,EAAiBH,EAAMU,CAAW,CAC5D,OAAQN,EAAP,CACA,QAAQ,MAAM,oBAAqBA,EAAM,OAAO,CAC/C,CACIJ,EAAK,SACVJ,EAAU,MAAM,QAAU,QAE9B"}